package com.zhanjixun.activity;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.TextView;

import com.zhanjixun.R;
import com.zhanjixun.adapter.TimelineAdapter;
import com.zhanjixun.data.DC;
import com.zhanjixun.interfaces.OnDataReturnListener;
import com.zhanjixun.utils.StringUtil;

/**
 * 物流详情页面
 * @author Imissyou
 *
 */
public class Order_Logisitice_Activity extends Activity implements OnDataReturnListener{
	
	
	//物流详情信息
		private ListView listView;
		//放回上一个页面
		private ImageView image_goBack;
		//商品图片
		private ImageView order_image;
		//物流状态
		private TextView  logistice_status;
		//物流公司
		private TextView  logistice_company;
		//物流编号
		private TextView  logistice_code;
		//物流电话
		private TextView  logistice_phone;
		
		
		//页面hear的数据
		private Map<String,Object> initData;
		
		private TimelineAdapter timeAdapter;
		/**
		 * 获取服务器数据的凭据
		 */
		private String user_id;
		private String order_id;
		private String URL = "null";
	
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_order_logistics_state_information);
		init();
		requestGetData();
		loadData(initData);
		listView.setAdapter(timeAdapter);
	}
	
	
	private boolean loadData(Map<String,Object> data) {
		if (null != data) {
			logistice_code.setText(data.get("code").toString());
			logistice_phone.setText(data.get("phone").toString());
			logistice_status.setText(data.get("order_serviceResult").toString());
			logistice_company.setText(data.get("company").toString());
//			order_image.setImageResource(data.get("order_image").hashCode());
			
			return true;
		}
		return false;
	}


	/**
	 * 根据订单号
	 * 获取页面的信息
	 * 为数据填充做准备
	 */
	private void requestGetData() {
		Intent intent = getIntent();
		Map<String , String > map = new HashMap<String, String>();
		order_id = intent.getStringExtra("order_id");
//		user_id = intent.getStringExtra("user_id");
		if (!StringUtil.isEmptyString(order_id)) {
			map.put("order_id", order_id);
//			map.put("user_id", user_id);
		}
		
		DC.getInstance().getDatasFromServer("Order_Logisitics", URL, map, this);
		
//		//Test
//		Map<String,Object> map = new HashMap<String, Object>();
//		map.put("phone", "13763012723");
//		map.put("code", "1234567890");
//		map.put("status", "正在发货中");
//		map.put("company", "圆通快递");
////		map.put("order_image", R.drawable.maoxia);
//		return map;
	}
	/**
     * 初始化控件.
     */
	private void init() {
		listView = (ListView) findViewById(R.id.logistice_informantion_listview);
		order_image = (ImageView) findViewById(R.id.logistics_state_information_Orderimage);
        logistice_status = (TextView) findViewById(R.id.logistics_state_information);
        logistice_code = (TextView) findViewById(R.id.logistics_status_information_code);
        logistice_company = (TextView) findViewById(R.id.order_logistics_information_company);
        logistice_phone = (TextView) findViewById(R.id.logistics_status_information_telPhone);
        timeAdapter = new TimelineAdapter(this, getListData());
	}
	
	/**
	 * 测试数据
	 * @return
	 */
	 private List<Map<String, Object>> getListData() {
	        List<Map<String, Object>> list = new ArrayList<Map<String, Object>>();

	        Map<String, Object> map = new HashMap<String, Object>();
	        map.put("time", "2015-05-20 10:15");
	        map.put("title", "深圳龙华收件");
	        list.add(map);

	        map = new HashMap<String, Object>();
	        map.put("time", "2015-05-21 9:25");
	        map.put("title", "离开深圳，发往上海");
	        list.add(map);

	        map = new HashMap<String, Object>();
	        map.put("time", "2015-05-22 12:55");
	        map.put("title", "上海浦江集散中心");
	        list.add(map);

	        map = new HashMap<String, Object>();
	        map.put("time", "2015-05-25 9:30");
	        map.put("title", "已收取快件");
	        list.add(map);
	        return list;
	    }

    /**
     * 获取服务器返回的数据.
     */
	@Override
	public void onDataReturn(String taskTag, Map<String, Object> result) {
		//获取返回数据
		if (taskTag.equals("Order_Logisitics")) {
			this.initData = result;
		}
	}
}
